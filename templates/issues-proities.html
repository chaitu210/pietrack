{%load static%}
<!DOCTYPE html>
<html>
  <head>
    <title>pieT</title>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700italic,700,900,900italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,500,300,600,700,800,900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{%static 'css/bs_leftnavi1.css'%}">
    <link rel="stylesheet" type="text/css" href="{%static 'css/bootstrap-colorpicker.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{%static 'css/docs.css'%}">
    <link rel="stylesheet" type="text/css" href="{%static 'css/slim_scroll.css'%}">
    <link rel="stylesheet" type="text/css" href="{%static 'css/main.css'%}">
  </head>
<body>
<header id='header_base'>
<!-- logo -->
	<!--<span class="logo">
	<i class='fa fa-pie-chart'></i>
	</span>-->
	<!--/ logo -->
	<!-- project mgmt -->
	<!--<span class='pg_mt'>
		<i class='fa fa-folder-open-o'></i>
	</span>-->
	<!--/ project mgmt -->
	<!-- left menu -->
	<div class='left_header'>
	<div class="menu">
	<ul>
    	<li>
			<span class='each_wrap child_logo'>
				<i class='fa fa-pie-chart'></i>
			</span>
		</li>
		<li>
			<span class='each_wrap child_project'>
				<i class='fa fa-folder-open-o'></i>
			</span>
		</li>
        
		<li>
			<span class='each_wrap child_one'>
				<i class='fa fa-clock-o'></i>
				<span class='name'>TimeLine</span>
			</span>
		</li>
		<li>
			<span class='each_wrap child_two'>
				<i class='fa fa-globe'></i>
				<span class='name'>Backlog</span>
			</span>
		</li>
		<li>
			<span class='each_wrap child_three'>
				<i class='fa fa-bug'></i>
				<span class='name'>Issues</span>
			</span>
		</li>
		<li>
			<span class='each_wrap child_four'>
				<i class='fa fa-language'></i>
				<span class='name'>Wiki</span>
			</span>
		</li>
		<li>
			<span class='each_wrap child_five'>
				<i class='fa fa-users'></i>
				<span class='name'>Team</span>
			</span>
		</li>
		<li>
			<span class='each_wrap child_six'>
				<i class='fa fa-gears'></i>
				<span class='name'>Settings</span>
			</span>
		</li>
	</ul>
	</div>
	</div>
	<!--/ left menu -->
	<!-- right header -->
	<div class='right_header'>
	<div class='menu'>
	<ul>
	<li class='parent_list'>
			<span class='each_wrap extras'>
				<i class='fa fa-arrow-down'></i>
				<span class='name'>Extras</span>
			</span>
			<ul class="sub_list_extras">
				<li>
					<span class='extras_drop_child extras_one'>
						<i class='fa fa-user'></i>
						<span class='name'>Profile</span>
					</span>
					</span>
				</li>
				<li>
					<span class='extras_drop_child extras_two'>
						<i class='fa fa-expeditedssl'></i>
						<span class='name'>Change Password</span>
					</span>
					</span>
				</li>
			</ul>
		</li>
		<li class='parent_list'>
			<span class='each_wrap notification'>
				<i class='fa fa-bell'></i>
				<span class='name'>Notifications</span>
				<span class='number count'>25</span>
			</span>
			<ul class='sub_list'>
			<div class='scroll'>

				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
				<li>
					<span class='ticket'>
						<img src='http://i.stack.imgur.com/8sNfT.jpg'>
						<span class='description'>
						<span class='name'>Nazneen</span>
						added you to project
						<span class='project'>Pie Track</span>
						<span class='time'>12 min ago</span>
						</span>
					</span>
				</li>
			</div>

			</ul>
		</li>
		<li>
			<span class='each_wrap logout'>
				<i class='fa fa-power-off'></i>
				<span class='name'>Logout</span>
			</span>
		</li>
	</ul>
	</span>
	<span class="name_img_wrap">
		<span class='name'>
			Hello, <span>Nazneen Shaik</span>
		</span>
		<img src='http://epicwpp.com/wp-content/uploads/Smiling-minions-Frank-and-Dave-holding-a-Seastar_www.EpicWpp.com_.jpg'>
        </span>
	</div>
	</div>
	<!--/ right header -->
</header>

	<section id="box-content">
    	<!-- nav left starts here--> 
		<div class="nav-left">
        	<!-- left menu starts here -->
            	<div class="nano-content">
                  <ul class="gw-nav gw-nav-list">
                    <li class="init-un-active"> <a href="javascript:void(0)"> <span class="gw-menu-text"> <i class="fa fa-area-chart"></i> Project Details</span> </a> </li>
                    <li class="init-arrow-down"> <a href="javascript:void(0)"> <span class="gw-menu-text"> <i class="fa fa-sort-amount-asc"></i> Attributes</span> <b class="gw-arrow"></b> </a>
                      <ul class="gw-submenu">
                        <li> <a href="javascript:void(0)">Status</a> </li>
                        <li> <a href="javascript:void(0)">Priorities</a> </li>
                        <li> <a href="javascript:void(0)">Severities</a> </li>
                      </ul>
                    </li>
                    <li > <a href="javascript:void(0)"> <span class="gw-menu-text"><i class="fa fa-users"></i> Members</span> </a>  </li>
                  </ul>
   		 </div>
            <!-- left menu ends here -->
        </div>
        <!-- nav left ends here-->
        
        <!-- right container starts here-->
        <div class="right-container">
        
        	<div class="panel panel-default content-panel">
            <div class="panel-body">
        	<!-- content box starts here -->
        	<div class="content_box">
                <div class="title">
                  <h4>SAMPL1 STATUS - <span class="status">Issues Priorities</span></h4>
                  <div class="tag">Specify the statuses your user stories, tasks and issues will go through</div>
                  <span class="new"><a href="#" id="id_new_pri">Add New Priority</a></span>
                </div>
				<!-- status table starts here -->
				<div class="table-responsive color-box">
                  <table class="table table-striped" id="priority">
                  <thead>
                    <tr>
                      <th width="40%">Color</th>
                      <th>Name</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                  {%for priority in priority_list%}
                    <tr id="row{{priority.id}}">
                      <td scope="row">
                      <div class="input-group colorpicker-component demo demo-auto">
                          <input type="text" value="{{priority.color}}" class="form-control"/>
                          <span class="input-group-addon"><i></i></span>
                      </div>
                     </td>
                      <td>{{priority.name}}</td>
                      <td class="actions"><a href="#" class="edit" onclick="edit_priority('{{priority.color}}','{{priority.name}}','row{{priority.id}}')"><i class="fa fa-edit"></i></a>
                      <a href="#" class="delete" onclick="delete_priority('{{priority.color}}','{{priority.name}}','row{{priority.id}}')"><i class="fa fa-trash"></i></a></td>
                    </tr>
                  {%endfor%}
                  </tbody>
                </table>

                <!-- form start -->
                <form action="" method="post" style="display:none;" id="id_issue_prio_form">
	                {% csrf_token %}
	                <input id="old_id" name="old_id" value="none" style="display:none;">
	                <table class="table table-striped">
	                  <thead>
	                    <tr>
	                      <th width="40%"></th>
	                      <th></th>
	                      <th></th>
	                    </tr>
	                  </thead>
	                  <tbody>
	                    <tr>
	                      <td scope="row">
	                      <div class="input-group colorpicker-component demo demo-auto">
	                          <input name="color" type="text" value="#666666" class="form-control"/>
	                          <span class="input-group-addon"><i></i></span>
	                      </div>
	                     </td>
	                      <td>
		                      <input name="name" value="" type="text" style="width: 100px; padding: 2px; border:1px solid #929292;" placeholder="Name"/>
		                  </td>
		                  <td class="actions">
		                      <button type="submit" class="edit" id="add_form"><i class="fa fa-plus"></i></button>
		                      <a class="delete" id="id_reset"><span class="glyphicon glyphicon-remove"></span></a>
                              
	                      </td>
	                    </tr>
	                    <tr>
	                    	<td colspan="3"><span name="error"></span></td>
	                    </tr>
	                  </tbody>
	                </table>
	            </form>
	            <!-- form ends here -->
                </div>
               <!-- status table ends here -->     
              <!-- content box starts here -->
              </div>
              </div>
             </div>
        </div>
        <!-- right container ends here-->
	</section>



	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="{%static 'js/jquery.slimscroll.js'%}"></script>
    <script type="text/javascript" src="{%static 'js/bs_leftnavi.js'%}"></script>
    <script src="{%static 'js/bootstrap-colorpicker.js'%}"></script>
    <script src="{%static 'js/docs.js'%}"></script>

    <script type="text/javascript">
      $(function(){
        $('.scroll').slimscroll({
          alwaysVisible: false,
          height: 390
        });
      });
      $('.sub_list,.sub_list_extras').mouseenter(function(event) {
      	$(this).closest('.parent_list').addClass('active_li_drop')
      });
      $('.sub_list,.sub_list_extras').mouseleave(function(event) {
      	$(this).closest('.parent_list').removeClass('active_li_drop')
      });


      /* backend code*/
      

      var row1="rr";
      function hexToRgb(hex) {
	    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
	    return result ? {
	        r: parseInt(result[1], 16),
	        g: parseInt(result[2], 16),
	        b: parseInt(result[3], 16)
	    } : null;
	}
	

      function create_issue_priority(form_id){
      	$('#'+form_id).serialize()
      	alert(form_id);
      	alert($('#'+form_id).serialize())

      }
      function clear_form(){
      	var form = $('#id_issue_prio_form');
      	form.css('display','none');
      	form.find('input[name="name"]').val(''); 
      	$('#id_issue_prio_form span[name="error"]').text('')
      	// $('#id_issue_prio_form').find("input[name='old_new']").val("new")
      	$("#old_id").val("none")
      }
      function edit_priority(color,name,row_id){
      	rowId = row_id.substring(3,row_id.length)
      	var r = hexToRgb(color).r
      	var g = hexToRgb(color).g
      	var b = hexToRgb(color).b
      	// console.log(r)
      	// console.log(g)
      	// console.log(b)
      	// var old_id = 
      	$("#old_id").val(rowId)
      	var color_box = '<i style="background-color: rgb('+r+','+ g+','+ b+');"></i>'
      	$('#id_issue_prio_form').css('display','block');
      	$('#id_issue_prio_form').find("input[name='color']").val(color)
      	$('#id_issue_prio_form').find("input[name='name']").val(name)
      	
      	$('#id_issue_prio_form span').html(color_box)
      	$('.demo').colorpicker();
      	row1=row_id;
      	// alert($("#old_id").val())
      }
      function delete_priority(color,name,row){
      	data_send = 'name='+name+'&color='+color+'&csrfmiddlewaretoken='+'{{csrf_token}}';
      	$.post('{%url "project:issues_priorities_delete" slug %}',data_send,function(response){
      		if(!response.error){
      			$('#'+row).remove();
      		}
      	});
      	// 
      }
      var count=0;
      $('#id_new_pri').on('click',function(){
      	clear_form()
		$('#id_issue_prio_form').css('display','block');
      	$('#id_issue_prio_form').find("input[name='old_new']").val("new")

      });

      $('#id_reset').on('click',function(){
      	clear_form();

      });
     
      /* adding new priority */

      $('#add_form').on('click',function(e){
        var create_data = $("#old_id").val()//$('#id_issue_prio_form').find('input[name="old_id"]').val()
        var rowCount = $('#priority tbody tr').length;
      	e.preventDefault();
      	if(create_data=="none"){
      		$.post('',$('#id_issue_prio_form').serialize(),function(response){
      			if(response.error){
      				if(response.errors['name']){
      					$("span[name='error']").text(response.errors['name']);
      				}
      			}
      			else{
      				
      				name = response['name'];
      				color = response['color'];
      				row_id = response['proj_id']

      				//rowCount+=1
      				data_row = "<tr id=\"row"+row_id+"\"><td scope=\"row\"><div class=\"input-group colorpicker-component demo demo-auto\"><input type=\"text\" value=\""+color+"\" class=\"form-control\"/><span class=\"input-group-addon\"><i></i></span></div></td><td>"+name+"</td><td class=\"actions\"><a href=\"#\" class=\"edit\" onclick=\"edit_priority('"+color+"','"+name+"','row"+row_id+"')\"><i class=\"fa fa-edit\"></i></a>&nbsp;<a href=\"#\" class=\"delete\" onclick=\"delete_priority('"+color+"','"+name+"','row"+row_id+"')\"><i class=\"fa fa-trash\"></i></a></td></tr>"
      				$('#priority tbody').append(data_row);
      				$('.demo').colorpicker();
      				clear_form();
      				rowCount+=1;
      			}

      	    });
      	}
        else{
        	var data = $('#id_issue_prio_form').serialize();
        	console.log(data)
        	$.post('{%url "project:issues_priorities_edit" slug %}',data,function(response){
        		
        		if(response.error){
      				if(response.errors['name']){
      					$("span[name='error']").text(response.errors['name']);
      				}
      			}
      			else{
      				var name = response['name'];
					var color = response['color'];
					var id = response['id'];
					var row_edit = $('#row'+id)
		        	var data_row = "<td scope=\"row\"><div class=\"input-group colorpicker-component demo demo-auto\"><input type=\"text\" value=\""+color+"\" class=\"form-control\"/><span class=\"input-group-addon\"><i></i></span></div></td><td>"+name+"</td><td class=\"actions\"><a href=\"#\" class=\"edit\" onclick=\"edit_priority('"+color+"','"+name+"','row"+id+"')\"><i class=\"fa fa-edit\"></i></a>&nbsp;<a href=\"#\" class=\"delete\" onclick=\"delete_priority('"+color+"','"+name+"','row"+id+"')\"><i class=\"fa fa-trash\"></i></a></td>"
        	
					row_edit.html(data_row);
      				$('.demo').colorpicker();
      				clear_form();
      			}
        	});
        }
      	
      });
      /* new priority ends here */

      /*ends */
    </script>
</body>
</html>