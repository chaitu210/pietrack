{%extends 'base.html'%}
{% load project_tags %}
{%load static %}
{%block content%}
    <section id='base_content'>
      <div class="project_description">
      <!-- about project -->
      <div class="col-md-9 about_project_wrap">
        <div class="title">
          <span>{{task.name}}</span>
        </div>
        <div class="profile-pic-count">
          <div class="col-md-12 content">
            <div class="profile-content">
              <div class="task_details">
                <b>Created By : </b>{{task.created_by.username}} ,<em> {{task.created_date|date:"d F,Y \a\t P"}}</em>
              </div> 
              <span class="desc">
                {{task.description}}
                <!-- <img src='img/user-pic.jpg' class="main-attachment"> -->
              </span>
              <div class="attachments_wrap">
               {% for attachment in task.attachments.all %}
                <div class="attachment_each">
                  <i class='fa fa-paperclip'></i>{{attachment.attached_file.name}}
                  <a><span class='view_link' data-toggle="modal" data-target="#{{attachment.id}}"><i class='fa fa-eye'></i>View</span></a>
                  <a href="{{attachment.attached_file.url}}" download><span class='download_link'><i class='fa fa-download'></i>Download</span></a>
                  <a><span class='delete_link'><i class='fa fa-trash'></i>Delete</span></a>
                </div>
                {% endfor %}
              </div>
              <!--<div class="attachement-gallery">
                <a class="fancybox-thumb" rel="fancybox-thumb" href="http://farm8.staticflickr.com/7495/16346747871_60b27a54b9_b.jpg" title="BrÃ¥viken (jarnasen)">
                <img src="http://farm8.staticflickr.com/7495/16346747871_60b27a54b9_m.jpg" alt="" />
                </a>
                <a class="fancybox-thumb" rel="fancybox-thumb" href="http://farm8.staticflickr.com/7381/16327260776_c3fa8ee76d_b.jpg" title="From the garden (*Jilltoo)">
                <img src="http://farm8.staticflickr.com/7381/16327260776_c3fa8ee76d_m.jpg" alt="" />
                </a>
                <a class="fancybox-thumb" rel="fancybox-thumb" href="http://farm9.staticflickr.com/8591/16141566979_347348e72c_b.jpg" title="cold forest (picturesbywalther)">
                <img src="http://farm9.staticflickr.com/8591/16141566979_347348e72c_m.jpg" alt="" />
                </a>
                <a class="fancybox-thumb" rel="fancybox-thumb" href="http://farm3.staticflickr.com/2895/14503817856_2f5d4b667b_b.jpg" title="Holly blue (Masa_N)">
                <img src="http://farm3.staticflickr.com/2895/14503817856_2f5d4b667b_m.jpg" alt="" />
                </a>
                          </div>-->
            </div>
          </div>
          <div class="clearfix"></div>
        </div>
        <div class="clearfix"></div>
        <!-- comments -->
        
      <div class="comments_wrap_div">
            <!-- your comment -->
              <form action="" method="post" enctype='multipart/form-data' id="comment_form">
                  {% csrf_token %}
                    <div class="your_comment">
                      <textarea name="comment"></textarea>
                       <p><span name="error"></span></p>
                      <span class='attachment' id="comment_attachment">
                      <i class='fa fa-paperclip'></i>
                      Attach a file
                      </span>
                      <span class='attachment' name="file_choosen"></span>
                      <input name="file" type="file" value="" id="comment_file" style="display:none;" />
                     
                      <button class='comment_btn' type="submit">Comment</button>
                    </div>
              </form>
          <!--/ your comment -->
        <!--/ main comment -->
          <div class="comment_each">
            <div class="img_div">
            <div class="img_wrap">
              <img src='http://cdnvideo.dolimg.com/cdn_assets/ff503a3f1529fe128cd3ab38d9fe680fc178da35.jpg'>
              </div>
              <div class="name">
                Nazneen Shaik
                <div class="designation">( Web Designer )</div>
                <div class="posted_details">31 Aug,2015 at <em>5:30 p.m</em></div>
              </div>
            </div>
            <div class="comment_text">
              Rapidiously embrace long-term high-impact manufactured products via enterprise-wide metrics. Seamlessly procrastinate cross-unit infomediaries before timely models. Monotonectally actualize excellent channels via corporate action items. Efficiently envisioneer dynamic strategic theme areas through scalable methodologies. Rapidiously fashion seamless paradigms without timely methodologies.
              <div class="attachments_wrap">
                <div class="attachment_each">
                  <i class='fa fa-paperclip'></i>Name of attachment or rather image
                  <a><span class='view_link' data-toggle="modal" data-target="#myModal1"><i class='fa fa-eye'></i>View</span></a>
                  <a><span class='download_link'><i class='fa fa-download'></i>Download</span></a>
                  <a><span class='delete_link'><i class='fa fa-trash'></i>Delete</span></a>
                </div>
                <div class="attachment_each">
                  <i class='fa fa-paperclip'></i>Name of attachment or rather image
                  <a><span class='view_link' data-toggle="modal" data-target="#myModal1"><i class='fa fa-eye'></i>View</span></a>
                  <a><span class='download_link'><i class='fa fa-download'></i>Download</span></a>
                  <a><span class='delete_link'><i class='fa fa-trash'></i>Delete</span></a>
                </div>
                <div class="attachment_each">
                  <i class='fa fa-paperclip'></i>Name of attachment or rather image
                  <a><span class='view_link' data-toggle="modal" data-target="#myModal1"><i class='fa fa-eye'></i>View</span></a>
                  <a><span class='download_link'><i class='fa fa-download'></i>Download</span></a>
                  <a><span class='delete_link'><i class='fa fa-trash'></i>Delete</span></a>
                </div>
                <div class="attachment_each">
                  <i class='fa fa-paperclip'></i>Name of attachment or rather image
                  <a><span class='view_link' data-toggle="modal" data-target="#myModal1"><i class='fa fa-eye'></i>View</span></a>
                  <a><span class='download_link'><i class='fa fa-download'></i>Download</span></a>
                  <a><span class='delete_link'><i class='fa fa-trash'></i>Delete</span></a>
                </div>
              </div>
              <div class="reply_button">
                <button><i class='fa fa-reply'></i>Reply</button>
              </div>
            </div>
          </div>
          <!-- main comment -->
          <!-- sub comment -->
          <div class="sub_comment">
          <div class="comment_each">
            <div class="img_div">
            <div class="img_wrap">
              <img src='http://cdnvideo.dolimg.com/cdn_assets/ff503a3f1529fe128cd3ab38d9fe680fc178da35.jpg'>
              </div>
              <div class="name">
                Nazneen Shaik
                <div class="designation">Web Designer</div>
                <div class="posted_details">31 Aug,2015 at <em>5:30 p.m</em></div>
              </div>
            </div>
            <div class="comment_text">
              Awesome :) check this link aswell.
              <div class="attachments_wrap">
                <div class="attachment_each">
                  <i class='fa fa-paperclip'></i>Name of attachment or rather image
                  <a><span class='view_link' data-toggle="modal" data-target="#myModal1"><i class='fa fa-eye'></i>View</span></a>
                  <a><span class='download_link'><i class='fa fa-download'></i>Download</span></a>
                  <a><span class='delete_link'><i class='fa fa-trash'></i>Delete</span></a>
                </div>
                </div>
              <div class="reply_button">
                <button><i class='fa fa-reply'></i>Reply</button>
              </div>
            </div>
          </div>
          </div>
          <!--/ sub comment -->
          <!-- sub comment -->
          <div class="sub_comment">
          <div class="comment_each">
            <div class="img_div">
            <div class="img_wrap">
              <img src='http://cdnvideo.dolimg.com/cdn_assets/ff503a3f1529fe128cd3ab38d9fe680fc178da35.jpg'>
              </div>
              <div class="name">
                Nazneen Shaik
                <div class="designation">Web Designer</div>
                <div class="posted_details">31 Aug,2015 at <em>5:30 p.m</em></div>
              </div>
            </div>
            <div class="comment_text">
              Thanks
              <div class="reply_button">
                <button><i class='fa fa-reply'></i>Reply</button>
              </div>
            </div>
          </div>
          </div>
          <!--/ sub comment -->

        </div>
        <!--/ comments -->
      </div>
      <!--/ about project -->
      <!-- team -->
      <div class="col-md-3 team">
        <div class="title">
          <span>team members</span>
        </div>
        <!-- ticket -->
        
        <div class="height_wrap">
          {% for team_member in task|Team_mem %}
          <span class='ticket orange'>
          {%if team_member.profile_pic %}
            <img src="{{ team_member.profile_pic.url }}">
          {% else %}
            <img src="{% static 'img/user-pic.jpg' %}">
          {% endif%}
          
          <span class='description'>
          <span class='name'>{{team_member.username}}</span>
          <span class='designation_time'>{{team_member|get_user_Role}}</span>
          </span>
          </span>
          {% endfor %}
          <!--/ ticket -->
        </div>
        <!--/ team -->
      </div>
  {% for attachment in task.attachments.all %}

      <div class="modal fade" id="{{attachment.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none; ">
        <div class="modal-dialog" role="document">
          <div class="modal-content" style="height:auto;">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã</span></button>
              <h4 class="modal-title" id="myModalLabel">Requirement 1</h4>
            </div>
            <div class="modal-body" >
              <iframe src="{{attachment.attached_file.url}}" width="100%" height="100%"></iframe>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
          <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã</span></button>
              <h4 class="modal-title" id="myModalLabel">Requirement 1</h4>
            </div>
            <div class="modal-body">
              Monotonectally syndicate premium users without client-centric intellectual capital. Quickly benchmark integrated manufactured products rather.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
            </div>
          </div>
        </div>
      </div>
    </section>

{%endblock%}

{% block extra_js %}
<script type="text/javascript">

$(function () {
    $('form#comment_form').on('submit', function(e){
        // var formData = new FormData();
        // formData.append('file', $('#comment_file').file);
        // formData.append($('form#comment_form').serialize()
        var formData = new FormData($(this)[0]);


          console.log($(this))
          $.ajax({
              url: "/project/{{slug}}/task/{{task.id}}/comment/",
              data: formData,
              enctype: 'multipart/form-data',
              processData: false,  // do not process the data as url encoded params
              contentType: false,   // by default jQuery sets this to urlencoded string
              type: 'POST',
              success: function ( response ) {
                 alert( response['error'] );
                 if(response['error'])
                 {
                    $("span[name='error']").text(response['errors'].comment)
                 }
              }
          });
          e.preventDefault()
    });
});


$(document).ready(function(){
  $('#comment_attachment').click(function() {
        $('#comment_file').click();
    });
  
});

</script>
{% endblock %}