{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
<section id='base_content' class='create_project'>
      <div class="content_box">
  <div class="title">
    <h4>User Profile</h4>
  </div>
  <div class="panel_box">
    <form class="" action="" method="post" id="post-form" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="user-pic-block">
        <span class="user-picture">

        <img id="profile_picture" src="{% if user.profile_pic %}{{ user.profile_pic.url }}{% else %}{% static 'img/user-pic.jpg' %}{% endif %}" width="100px" height="100px"/>

                 </span>
        <span class="pic-size">The image will be scaled to 80x80px.</span>
        <span class="pic-btn">
                     <button id="change_picture_button">Change Picture</button>
                    <input id="id_profile_pic" name="profile_pic" type="file" style='display:none;' onchange="loadFile(event)" />
                 </span>
      </div>
      <div class="form_group">
        <label for="username">User Name</label>
        <input id="username" name="username" type="text" class='input' placeholder="Enter your username here" value="{{ user.username }}">
        <span name="username"></span>
      </div>
      <div class="form_group">
        <label for="email">Email Address</label>
        <input type="text" class='input' id="email" name="email" placeholder="Enter your email here" value="{{ user.email }}" disabled>
        <span name="email"></span>
      </div>
      <div class="form_group">
        <label for="first_name">Full Name</label>
        <input type="text" class='input' id="first_name" name="first_name" placeholder="Enter your full name here" value="{{ user.first_name }}">
        <span name="first_name"></span>
      </div>
      <div class="form_group">
        <label for="organization">organization</label>
        <input type="text" class='input' id="organization" name="organization" placeholder="Enter your organization name here" value="{{ user.organization.name }}">
        <span name="organization"></span>
      </div>
      <div class="form_group">
        <label for="biography">About You</label>
        <textarea class="form-control textarea" id="biography" name="biography" placeholder="Please fill about your self">{{ user.biography }}</textarea>
        <span name="biography"></span>
      </div>
      <button>Save</button>
    </form>
  </div>
</div>
</section>

{% endblock %}
{% block extra_js %}
    <script src="http://malsup.github.com/jquery.form.js"></script>
        <script type="text/javascript" >

        $("#change_picture_button").click(function(e){
        e.preventDefault();
        $("#id_profile_pic").click()
        });

        $('#post-form').ajaxForm(function(){

            $.post("{% url 'user:user_profile' %}",$('#post-form').serialize(), function(data){
                if(data.error){
                    $('p.error_required').remove();
                    for (var key in data.response) {
                        $('#' + key).after('<p class="error_required">' + data.response[key] + '</p>');
                    }
                }else{
                    alert(data['response']);
                    window.location=''
                }
            }, 'json');
        });

  // for changing the profile-picture on browsing
        var loadFile = function(event) {
            var output = document.getElementById('profile_picture');
            output.src = URL.createObjectURL(event.target.files[0]);
        };


    </script>

{% endblock %}